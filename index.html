<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katalog Produk Monggo</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a; --bg-medium: #1e293b; --bg-light: #334155;
            --text-primary: #f8fafc; --text-secondary: #94a3b8;
            --accent: #22d3ee; --accent-dark: #0891b2;
            --danger: #ef4444; --success: #22c55e;
            --container-width: 1280px; --border-color: #475569; --border-radius: 0.5rem;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg-dark); color: var(--text-primary); font-family: system-ui, -apple-system, sans-serif; }
        .container { max-width: var(--container-width); margin: 0 auto; padding: 0 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: var(--border-radius); font-weight: bold; cursor: pointer; transition: background-color 0.2s, transform 0.1s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--accent-dark); color: var(--text-primary); }
        .btn-primary:hover { background-color: #06b6d4; }
        .btn-full { width: 100%; }
        .icon-button { background: none; border: none; color: var(--text-primary); padding: 0.5rem; border-radius: 50%; cursor: pointer; position: relative; transition: background-color 0.2s; }
        .icon-button:hover { background-color: var(--bg-light); }
        .empty-state { text-align: center; padding: 3rem 1rem; color: var(--text-secondary); background-color: var(--bg-medium); border-radius: var(--border-radius); }
        .empty-state button { margin-top: 1rem; }
        .view-title { font-size: 1.75rem; font-weight: bold; margin-bottom: 1.5rem; }
        #app-header { background-color: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 50; }
        #app-header .container { display: flex; align-items: center; gap: 1rem; height: 64px; }
        #brand-logo { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 1.75rem; cursor: pointer; background: linear-gradient(45deg, var(--accent), #f97316, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; margin-right: 1.5rem; }
        #header-nav { display: flex; align-items: center; gap: 0.5rem; }
        .search-container { flex-grow: 1; position: relative; }
        .search-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none; }
        #search-input { width: 100%; background-color: var(--bg-light); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 0.6rem 0.75rem 0.6rem 2.5rem; color: var(--text-primary); font-size: 1rem; transition: border-color 0.2s; }
        #search-input:focus { outline: none; border-color: var(--accent); }
        .cart-badge { position: absolute; top: 0px; right: 0px; background-color: var(--danger); color: white; font-size: 0.7rem; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        #app-main { padding-top: 1.5rem; padding-bottom: 5rem; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1.25rem; }
        .product-card { background-color: var(--bg-medium); border-radius: var(--border-radius); overflow: hidden; cursor: pointer; transition: transform 0.2s ease-out, box-shadow 0.2s; display: flex; flex-direction: column; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.2); }
        .product-card img { width: 100%; height: 160px; object-fit: cover; }
        .product-card-info { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
        .product-card-info h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; flex-grow: 1; line-height: 1.4; }
        .product-card-info p { font-size: 1.125rem; font-weight: bold; color: var(--accent); }
        .detail-container { max-width: 1000px; margin: auto; background-color: var(--bg-medium); border-radius: var(--border-radius); overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        @media (min-width: 768px) { .detail-container { flex-direction: row; } }
        .detail-gallery { flex-basis: 50%; min-width: 50%; }
        .detail-main-media { aspect-ratio: 1 / 1; background-color: black; position: relative; }
        .detail-main-media img, .detail-main-media iframe { width: 100%; height: 100%; object-fit: cover; border: none; }
        .gallery-nav { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.4); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; }
        .gallery-nav:hover { background-color: rgba(0,0,0,0.7); }
        .gallery-nav.prev { left: 0.75rem; } .gallery-nav.next { right: 0.75rem; }
        .detail-thumbnails { display: flex; padding: 0.5rem; background-color: var(--bg-dark); overflow-x: auto; }
        .thumbnail, .video-thumbnail { width: 64px; height: 64px; object-fit: cover; border-radius: 0.375rem; margin-right: 0.5rem; cursor: pointer; border: 3px solid transparent; flex-shrink: 0; transition: border-color 0.2s; }
        .thumbnail.active, .video-thumbnail.active { border-color: var(--accent); }
        .video-thumbnail { display: flex; align-items: center; justify-content: center; background-color: var(--bg-light); }
        .detail-info { flex-basis: 50%; padding: 2rem; display: flex; flex-direction: column; }
        .detail-info h2 { font-size: 2.25rem; font-weight: bold; line-height: 1.2; margin-bottom: 0.75rem; }
        .detail-info .price { font-size: 2.25rem; font-weight: bold; color: var(--accent); margin-bottom: 1.5rem; }
        .detail-info .description { color: var(--text-secondary); margin-bottom: 1.5rem; flex-grow: 1; line-height: 1.6; }
        .cart-items-container-wrapper, .checkout-form-wrapper { max-width: 768px; margin: auto; }
        .cart-items-container { background-color: var(--bg-medium); border-radius: var(--border-radius); padding: 1.5rem; }
        .cart-item { display: flex; align-items: center; gap: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem; }
        .cart-item:last-child { border-bottom: none; margin-bottom: 0; }
        .cart-item img { width: 80px; height: 80px; object-fit: cover; border-radius: var(--border-radius); }
        .cart-item-info { flex-grow: 1; } .cart-item-info p { font-weight: 600; } .cart-item-info span { font-size: 0.875rem; color: var(--accent); }
        .quantity-control { display: flex; align-items: center; gap: 0.75rem; }
        .quantity-control button { background-color: var(--bg-light); border: none; border-radius: 50%; width: 30px; height: 30px; font-weight: bold; font-size: 1rem; color: var(--text-primary); cursor: pointer; transition: background-color 0.2s; }
        .quantity-control button:hover { background-color: #475569; }
        .cart-total { display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: bold; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }
        .checkout-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; }
        @media (min-width: 768px) { .checkout-grid { grid-template-columns: 1fr 0.8fr; } }
        .form-section { background-color: var(--bg-medium); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; }
        .form-section:last-child { margin-bottom: 0; }
        .section-title { font-weight: bold; font-size: 1.25rem; margin-bottom: 1.25rem; display: flex; align-items: center; gap: 0.75rem; }
        .section-title i { color: var(--accent); }
        .input-group { position: relative; margin-bottom: 1.25rem; }
        .input-group.coupon-group { display: flex; gap: 0.5rem; }
        .input-group.coupon-group input { flex-grow: 1; padding-left: 1rem !important; }
        .input-group.coupon-group button { flex-shrink: 0; padding: 0 1rem; }
        .input-group i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .input-group input, .input-group select { width: 100%; background-color: var(--bg-dark); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 0.8rem 1rem 0.8rem 3rem; color: var(--text-primary); font-size: 1rem; -webkit-appearance: none; appearance: none; }
        .input-group select { padding: 0.8rem 1rem; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: var(--accent); }
        .summary-items-list { max-height: 250px; overflow-y: auto; margin-bottom: 1rem; padding-right: 0.5rem; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 0.75rem; font-size: 0.9rem; }
        .summary-item .name { color: var(--text-secondary); } .summary-item .price { font-weight: 500; }
        .summary-total { display: flex; flex-direction: column; gap: 0.5rem; font-weight: bold; padding-top: 1rem; border-top: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .summary-total > div { display: flex; justify-content: space-between; }
        .summary-total .discount { color: var(--success); }
        .summary-total .grand-total { font-size: 1.25rem; margin-top: 0.5rem; }
        .voucher-hint-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
        .voucher-hint { background-color: var(--bg-light); color: var(--accent); border: 1px dashed var(--accent); padding: 0.25rem 0.5rem; font-size: 0.8rem; font-weight: bold; border-radius: 0.25rem; cursor: pointer; transition: background-color 0.2s; }
        .voucher-hint:hover { background-color: var(--accent-dark); color: var(--text-primary); }
        .fab { position: fixed; bottom: 1.5rem; right: 1.5rem; width: 60px; height: 60px; background-color: var(--success); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; transition: background-color 0.2s, transform 0.2s; z-index: 40; }
        .fab:hover { background-color: #16a34a; transform: scale(1.1); }
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 100; display: none; backdrop-filter: blur(5px); }
        #payment-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background-color: var(--bg-medium); border-radius: var(--border-radius); box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 101; display: none; text-align: center; padding: 2rem; border: 1px solid var(--border-color); }
        #payment-modal h2 { font-size: 1.5rem; color: var(--text-primary); margin-bottom: 1rem; }
        #payment-qris-code { width: 100%; max-width: 250px; height: auto; border-radius: var(--border-radius); margin: 1rem auto; background-color: white; }
        .payment-details p { font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        .payment-details .total-amount { font-size: 2rem; font-weight: bold; color: var(--accent); margin: 0.5rem 0 1.5rem 0; }
        .payment-instructions { text-align: left; font-size: 0.9rem; color: var(--text-secondary); margin-top: 1.5rem; padding-left: 1rem; }
        .payment-instructions li { margin-bottom: 0.5rem; }
        #close-modal-btn { margin-top: 2rem; background-color: var(--bg-light); }
        .tracking-result { margin-top: 2rem; background-color: var(--bg-medium); padding: 1.5rem; border-radius: var(--border-radius); }
        .tracking-status { list-style: none; padding: 0; }
        .tracking-status li { padding: 1rem; border-left: 3px solid var(--bg-light); position: relative; }
        .tracking-status li:before { content: ''; width: 15px; height: 15px; background: var(--bg-light); border-radius: 50%; position: absolute; left: -9px; top: 50%; transform: translateY(-50%); }
        .tracking-status li.completed { border-left-color: var(--success); }
        .tracking-status li.completed:before { background: var(--success); }
        .tracking-status li p { margin: 0; }
        .tracking-status li .status { font-weight: bold; }
        .tracking-status li .date { font-size: 0.8rem; color: var(--text-secondary); }
    </style>
</head>
<body>

    <header id="app-header">
        <div class="container">
            <button id="back-button" class="icon-button" style="display: none;"><i data-lucide="arrow-left"></i></button>
            <h1 id="brand-logo">Monggo</h1>
            <div class="search-container"><i data-lucide="search" class="search-icon"></i><input type="text" id="search-input" placeholder="Cari"></div>
            <div id="header-nav">
                <button id="track-order-btn" class="icon-button" title="Lacak Pesanan"><i data-lucide="truck"></i></button>
                <button id="cart-button" class="icon-button" title="Keranjang"><i data-lucide="shopping-cart"></i><span id="cart-item-count" class="cart-badge" style="display: none;">0</span></button>
            </div>
        </div>
    </header>
    
    <main id="app-main" class="container">
        <div id="catalog-view"><h2 class="view-title">Jelajahi Produk Kami</h2><div id="product-grid"></div><p id="no-products-message" class="empty-state" style="display: none;">Produk tidak ditemukan.</p></div>
        <div id="product-detail-view" style="display: none;"></div>
        <div id="cart-view" style="display: none;"><h2 class="view-title">Keranjang Belanja</h2><div class="cart-items-container-wrapper"><div id="cart-items-container"></div><div id="cart-empty-message" class="empty-state" style="display: none;"><p>Keranjang Anda masih kosong.</p><button id="start-shopping-button" class="btn btn-primary">Mulai Belanja</button></div><div id="cart-summary" style="display: none;"><div class="cart-total"><span>Total Belanja:</span><span id="cart-total-price"></span></div><button id="checkout-button" class="btn btn-primary btn-full">Lanjut ke Checkout</button></div></div></div>
        <div id="checkout-view" style="display: none;">
             <h2 class="view-title">Checkout Pesanan</h2>
             <div class="checkout-form-wrapper">
                 <form id="checkout-form">
                    <div class="checkout-grid">
                        <div class="form-column">
                            <div class="form-section">
                                <h3 class="section-title"><i data-lucide="map-pin"></i> Alamat Pengiriman</h3>
                                <div class="input-group"><i data-lucide="user"></i><input type="text" id="customer-name" placeholder="Nama Lengkap Penerima" required></div>
                                <div class="input-group"><i data-lucide="home"></i><input type="text" id="customer-address" placeholder="Jalan, Nomor Rumah, Kota, Kode Pos" required></div>
                                <div class="input-group"><i data-lucide="phone"></i><input type="tel" id="customer-phone" placeholder="Nomor Telepon Aktif" required></div>
                            </div>
                            <div class="form-section">
                                <h3 class="section-title"><i data-lucide="truck"></i> Metode Pengiriman</h3>
                                <div class="input-group">
                                    <i data-lucide="truck" style="z-index: 1;"></i>
                                    <select id="shipping-method" required>
                                        <option value="" disabled selected>Pilih Kurir...</option>
                                        <option value="15000">JNE Reguler (Rp 15.000)</option>
                                        <option value="18000">J&T Express (Rp 18.000)</option>
                                        <option value="22000">SiCepat BEST (Rp 22.000)</option>
                                        <option value="12000">Kurir Pribadi (Rp 12.000)</option>
                                        <option value="20000" data-cod="true">COD - Bayar di Tempat (Rp 20.000)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="summary-column">
                            <div class="form-section">
                                <h3 class="section-title"><i data-lucide="package"></i> Ringkasan Pesanan</h3>
                                <div id="summary-items-list"></div>
                                <hr style="border-color: var(--border-color); margin: 1rem 0;">
                                <label for="coupon-code" style="font-size: 0.9rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Punya kode voucher?</label>
                                <div id="voucher-hint-container" class="voucher-hint-container"></div>
                                <div class="input-group coupon-group">
                                    <input type="text" id="coupon-code" placeholder="Masukkan Kode Voucher">
                                    <button type="button" id="apply-coupon-btn" class="btn btn-primary">Pakai</button>
                                </div>
                                <div class="summary-total">
                                    <div id="summary-subtotal"><span>Subtotal</span><span>Rp 0</span></div>
                                    <div id="summary-shipping"><span>Ongkos Kirim</span><span>Rp 0</span></div>
                                    <div id="summary-discount" style="display: none;"><span>Diskon</span><span class="discount">- Rp 0</span></div>
                                    <hr style="border-color: var(--border-color); margin: 0.5rem 0;">
                                    <div class="grand-total" id="summary-grand-total"><span>Total Bayar</span><span>Rp 0</span></div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-full"><i data-lucide="shield-check"></i> Buat Pesanan & Bayar</button>
                            </div>
                        </div>
                    </div>
                 </form>
             </div>
        </div>
        <div id="tracking-view" style="display: none;"><h2 class="view-title">Lacak Pesanan Anda</h2><div class="form-section"><p style="color: var(--text-secondary); margin-bottom: 1rem;">Masukkan nomor resi yang Anda terima setelah pembayaran untuk melihat status pengiriman.</p><form id="tracking-form"><div class="input-group"><i data-lucide="search"></i><input type="text" id="tracking-input" placeholder="Contoh: JNE-171822..." required></div><button type="submit" class="btn btn-primary btn-full">Lacak</button></form><div id="tracking-result-container" style="display: none;"></div></div></div>
    </main>

    <a href="https://wa.me/6285179848497?text=Halo%2C%20saya%20tertarik%20dengan%20produk%20Anda" class="fab" title="Hubungi via WhatsApp" target="_blank" rel="noopener noreferrer"><i data-lucide="message-circle"></i></a>
    
    <div id="modal-overlay"></div>
    <div id="payment-modal">
        <h2>Selesaikan Pembayaran</h2>
        <img id="payment-qris-code" src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=qris-placeholder" alt="QRIS Code Pembayaran">
        <div class="payment-details">
            <p>Total Pembayaran:</p>
            <p class="total-amount" id="modal-total-amount">Rp 0</p>
            <p>Bayar ke DANA:</p>
            <p style="font-weight: bold; color: var(--text-primary);">0851-7984-8497</p>
        </div>
        <ol class="payment-instructions">
            <li>Buka aplikasi DANA atau e-wallet lain.</li>
            <li>Pilih menu 'Bayar' atau 'Pay'.</li>
            <li>Scan QR Code di atas.</li>
            <li>Pastikan nominal pembayaran sudah sesuai.</li>
            <li>Selesaikan pembayaran.</li>
        </ol>
        <button id="close-modal-btn" class="btn btn-full">Saya Sudah Bayar & Konfirmasi via WhatsApp</button>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const products = [ { id: 1, name: 'Kamera Mirrorless ProX', description: 'Kamera mirrorless profesional dengan sensor full-frame 45MP.', price: 32500000, images: ['https://placehold.co/600x600/1a1a1a/ffffff?text=Kamera+Depan', 'https://placehold.co/600x600/1a1a1a/ffffff?text=Kamera+Samping'], videoYoutubeId: 'l_a59h8a-0k' }, { id: 2, name: 'Drone DJI Air 3', description: 'Drone lipat dengan kamera ganda dan video 4K/100fps.', price: 17800000, images: ['https://placehold.co/600x600/2a2a2a/ffffff?text=Drone+Terbang', 'https://placehold.co/600x600/2a2a2a/ffffff?text=Drone+Terlipat'], videoYoutubeId: 'r_T-nC2wR9c' }, { id: 3, name: 'Laptop Gaming ROG Strix', description: 'Ditenagai oleh Intel Core i9 Gen-13 dan RTX 4080.', price: 45999000, images: ['https://placehold.co/600x600/1c1c1c/ffffff?text=Laptop+Depan', 'https://placehold.co/600x600/1c1c1c/ffffff?text=Keyboard+RGB'], videoYoutubeId: 'AbkUda2m6_0' }, { id: 4, name: 'Sepatu Lari Ultraboost', description: 'Sepatu lari dengan bantalan Boost yang responsif.', price: 2800000, images: ['https://placehold.co/600x600/2b2b2b/ffffff?text=Sepatu+Samping', 'https://placehold.co/600x600/2b2b2b/ffffff?text=Sepatu+Atas'], videoYoutubeId: null }, { id: 5, name: 'Smartwatch Titan Pro', description: 'Smartwatch tangguh dengan GPS dan 100+ mode olahraga.', price: 3500000, images: ['https://placehold.co/600x600/3a3a3a/ffffff?text=Watch+Face', 'https://placehold.co/600x600/3a3a3a/ffffff?text=Watch+Samping'], videoYoutubeId: null }, { id: 6, name: 'Mechanical Keyboard K8 Pro', description: 'Keyboard mekanikal nirkabel dengan layout TKL.', price: 1650000, images: ['https://placehold.co/600x600/1e1e1e/ffffff?text=Keyboard+Atas', 'https://placehold.co/600x600/1e1e1e/ffffff?text=Detail+Switch'], videoYoutubeId: 'kUy31G36d24' } ];
            let cart = []; let currentView = 'catalog'; let historyStack = ['catalog']; let lastOrderDetails = null; let appliedDiscount = 0;
            const availableVouchers = [
                { code: 'MONGGOHEMAT', value: 25000, type: 'fixed' },
            ];
            const modalOverlay = document.getElementById('modal-overlay'); const paymentModal = document.getElementById('payment-modal'); const closeModalBtn = document.getElementById('close-modal-btn'); const modalTotalAmount = document.getElementById('modal-total-amount'); const qrisCodeImg = document.getElementById('payment-qris-code');
            const views = { catalog: document.getElementById('catalog-view'), productDetail: document.getElementById('product-detail-view'), cart: document.getElementById('cart-view'), checkout: document.getElementById('checkout-view'), tracking: document.getElementById('tracking-view') };
            const productGrid = document.getElementById('product-grid'); const searchInput = document.getElementById('search-input'); const cartItemCount = document.getElementById('cart-item-count'); const backButton = document.getElementById('back-button'); const cartButton = document.getElementById('cart-button'); const brandLogo = document.getElementById('brand-logo'); const trackOrderBtn = document.getElementById('track-order-btn');
            const shippingMethodSelect = document.getElementById('shipping-method'); const couponInput = document.getElementById('coupon-code'); const applyCouponBtn = document.getElementById('apply-coupon-btn');
            const formatCurrency = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);

            const renderVoucherHints = () => {
                const hintContainer = document.getElementById('voucher-hint-container');
                hintContainer.innerHTML = '';
                availableVouchers.forEach(voucher => {
                    const hint = document.createElement('div');
                    hint.className = 'voucher-hint';
                    hint.textContent = voucher.code;
                    hint.title = `Klik untuk pakai voucher potongan ${formatCurrency(voucher.value)}`;
                    hint.addEventListener('click', () => {
                        couponInput.value = voucher.code;
                        applyCouponBtn.click();
                    });
                    hintContainer.appendChild(hint);
                });
            };

            const renderCatalog = (productsToRender) => { const productList = productsToRender || products; productGrid.innerHTML = ''; document.getElementById('no-products-message').style.display = productList.length === 0 ? 'block' : 'none'; productList.forEach(product => { const card = document.createElement('div'); card.className = 'product-card'; card.dataset.productId = product.id; card.innerHTML = `<img src="${product.images[0]}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/300x300/1e293b/ffffff?text=Error';"><div class="product-card-info"><h3>${product.name}</h3><p>${formatCurrency(product.price)}</p></div>`; card.addEventListener('click', () => { renderProductDetail(product.id); switchView('productDetail'); }); productGrid.appendChild(card); }); };
            const renderProductDetail = (productId) => { const product = products.find(p => p.id === productId); if (!product) return; let thumbnailHTML = product.images.map((img, index) => `<img src="${img}" class="thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}" alt="thumbnail ${index + 1}" onerror="this.onerror=null;this.style.display='none';">`).join(''); if (product.videoYoutubeId) { thumbnailHTML += `<div class="video-thumbnail" data-video-id="${product.videoYoutubeId}"><i data-lucide="video"></i></div>`; } views.productDetail.innerHTML = `<div class="detail-container"><div class="detail-gallery"><div class="detail-main-media"></div><div class="detail-thumbnails">${thumbnailHTML}</div></div><div class="detail-info"><h2>${product.name}</h2><p class="price">${formatCurrency(product.price)}</p><p class="description">${product.description}</p><button class="btn btn-primary btn-full add-to-cart-detail"><i data-lucide="shopping-cart"></i> Tambah ke Keranjang</button></div></div>`; if (typeof lucide !== 'undefined') lucide.createIcons(); let currentImageIndex = 0; const mainMediaContainer = views.productDetail.querySelector('.detail-main-media'); const updateMedia = (index, isVideo = false) => { mainMediaContainer.innerHTML = ''; views.productDetail.querySelectorAll('.thumbnail, .video-thumbnail').forEach(t => t.classList.remove('active')); if (isVideo) { mainMediaContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${product.videoYoutubeId}?autoplay=1&rel=0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`; views.productDetail.querySelector('.video-thumbnail').classList.add('active'); } else { currentImageIndex = index; mainMediaContainer.innerHTML = `<img src="${product.images[index]}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/600x600/1e293b/ffffff?text=Image+Error';"><button class="gallery-nav prev"><i data-lucide="chevron-left"></i></button><button class="gallery-nav next"><i data-lucide="chevron-right"></i></button>`; views.productDetail.querySelector(`.thumbnail[data-index="${index}"]`).classList.add('active'); if (typeof lucide !== 'undefined') lucide.createIcons(); mainMediaContainer.querySelector('.prev').addEventListener('click', () => navigateGallery(-1)); mainMediaContainer.querySelector('.next').addEventListener('click', () => navigateGallery(1)); } }; const navigateGallery = (direction) => { let newIndex = (currentImageIndex + direction + product.images.length) % product.images.length; updateMedia(newIndex); }; updateMedia(0); views.productDetail.querySelectorAll('.thumbnail, .video-thumbnail').forEach(thumb => { thumb.addEventListener('click', () => { if (thumb.dataset.videoId) { updateMedia(null, true); } else { updateMedia(parseInt(thumb.dataset.index)); } }); }); views.productDetail.querySelector('.add-to-cart-detail').addEventListener('click', () => addToCart(product.id)); };
            const renderCart = () => { const wrapper = document.querySelector('#cart-view .cart-items-container-wrapper'); const container = document.getElementById('cart-items-container'); const emptyMessage = document.getElementById('cart-empty-message'); const summary = document.getElementById('cart-summary'); const totalPrice = cart.reduce((total, item) => total + item.price * item.quantity, 0); if (cart.length === 0) { wrapper.style.display = "block"; container.innerHTML = ''; emptyMessage.style.display = 'block'; summary.style.display = 'none'; } else { wrapper.style.display = "block"; emptyMessage.style.display = 'none'; summary.style.display = 'block'; container.innerHTML = cart.map(item => `<div class="cart-item" data-product-id="${item.id}"><img src="${item.images[0]}" alt="${item.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x80/1e293b/ffffff?text=X';"><div class="cart-item-info"><p>${item.name}</p><span>${formatCurrency(item.price)}</span></div><div class="quantity-control"><button class="quantity-change" data-change="-1">-</button><span>${item.quantity}</span><button class="quantity-change" data-change="1">+</button></div><button class="remove-item icon-button" style="color: var(--danger);"><i data-lucide="trash-2"></i></button></div>`).join(''); document.getElementById('cart-total-price').textContent = formatCurrency(totalPrice); } updateCartCount(); if (typeof lucide !== 'undefined') lucide.createIcons(); };
            
            const updateCheckoutSummary = () => {
                const subtotal = cart.reduce((total, item) => total + item.price * item.quantity, 0); const shippingCost = parseInt(shippingMethodSelect.value) || 0;
                const grandTotal = subtotal + shippingCost - appliedDiscount;
                document.querySelector('#summary-subtotal span:last-child').textContent = formatCurrency(subtotal);
                document.querySelector('#summary-shipping span:last-child').textContent = formatCurrency(shippingCost);
                const discountDiv = document.getElementById('summary-discount');
                if (appliedDiscount > 0) { discountDiv.style.display = 'flex'; discountDiv.querySelector('span:last-child').textContent = `- ${formatCurrency(appliedDiscount)}`; } 
                else { discountDiv.style.display = 'none'; }
                document.querySelector('#summary-grand-total span:last-child').textContent = formatCurrency(grandTotal > 0 ? grandTotal : 0);
            };
            const renderCheckout = () => { const summaryList = document.getElementById('summary-items-list'); summaryList.innerHTML = cart.map(item => `<div class="summary-item"><span class="name">${item.name} x${item.quantity}</span><span class="price">${formatCurrency(item.price * item.quantity)}</span></div>`).join(''); appliedDiscount = 0; couponInput.value = ''; renderVoucherHints(); updateCheckoutSummary(); };
            const switchView = (viewName) => { window.scrollTo(0, 0); currentView = viewName; Object.values(views).forEach(view => view.style.display = 'none'); views[viewName].style.display = 'block'; if (viewName !== 'catalog' && historyStack[historyStack.length - 1] !== viewName) { historyStack.push(viewName); } backButton.style.display = historyStack.length > 1 ? 'flex' : 'none'; if (viewName === 'cart') renderCart(); if (viewName === 'checkout') renderCheckout(); };
            const updateCartCount = () => { const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0); cartItemCount.style.display = totalItems > 0 ? 'flex' : 'none'; cartItemCount.textContent = totalItems; };
            const addToCart = (productId) => { const product = products.find(p => p.id === productId); const existingItem = cart.find(item => item.id === productId); if (existingItem) { existingItem.quantity++; } else { cart.push({ ...product, quantity: 1 }); } alert(`"${product.name}" telah ditambahkan ke keranjang!`); updateCartCount(); };
            const updateCartQuantity = (productId, change) => { const itemIndex = cart.findIndex(i => i.id === productId); if (itemIndex > -1) { cart[itemIndex].quantity += change; if (cart[itemIndex].quantity <= 0) { cart.splice(itemIndex, 1); } } renderCart(); };
            
            const handleApplyCoupon = () => {
                const enteredCode = couponInput.value.trim().toUpperCase();
                const matchedVoucher = availableVouchers.find(v => v.code === enteredCode);
                if (matchedVoucher) {
                    appliedDiscount = matchedVoucher.value;
                    alert(`Kode voucher berhasil diterapkan! Anda mendapat potongan sebesar ${formatCurrency(appliedDiscount)}.`);
                } else {
                    appliedDiscount = 0;
                    alert('Kode voucher tidak valid.');
                }
                updateCheckoutSummary();
            };
            const handleCheckoutSubmit = (e) => {
                e.preventDefault(); 
                if (cart.length === 0) { alert("Keranjang Anda kosong!"); return; }
                const customerName = document.getElementById('customer-name').value.trim(); const customerAddress = document.getElementById('customer-address').value.trim(); const customerPhone = document.getElementById('customer-phone').value.trim();
                const shippingCost = parseInt(shippingMethodSelect.value); const selectedOption = shippingMethodSelect.options[shippingMethodSelect.selectedIndex];
                const shippingName = selectedOption.text; const isCod = selectedOption.dataset.cod === 'true';
                if (!customerName || !customerAddress || !customerPhone) { alert('Harap isi semua detail alamat pengiriman.'); return; }
                if (!shippingCost && shippingMethodSelect.value === "") { alert('Harap pilih metode pengiriman.'); return; }
                const subtotal = cart.reduce((total, item) => total + item.price * item.quantity, 0);
                let grandTotal = subtotal + shippingCost - appliedDiscount; if(grandTotal < 0) grandTotal = 0;
                const trackingNumber = `${shippingName.split(' ')[0].toUpperCase()}-${Date.now()}`;
                lastOrderDetails = { customerName, customerAddress, customerPhone, grandTotal, shippingName, trackingNumber, isCod, appliedDiscount };
                if (isCod) { confirmOrderAndRedirect(true); } 
                else { modalTotalAmount.textContent = formatCurrency(grandTotal); const qrisImageUrl = 'https://i.ibb.co/6n0yW1c/qris-dana-romanzaey.png'; qrisCodeImg.src = qrisImageUrl; modalOverlay.style.display = 'block'; paymentModal.style.display = 'block'; }
            };
            const confirmOrderAndRedirect = (isCodOrder = false) => {
                if (!lastOrderDetails) return;
                modalOverlay.style.display = 'none'; paymentModal.style.display = 'none';
                let orderSummaryText = `*Konfirmasi Pesanan Baru (Resi: ${lastOrderDetails.trackingNumber})*\n\n`;
                cart.forEach(item => { orderSummaryText += `• ${item.name} (x${item.quantity})\n`; });
                orderSummaryText += `\n*Pengiriman:* ${lastOrderDetails.shippingName}`;
                if (lastOrderDetails.appliedDiscount > 0) { orderSummaryText += `\n*Diskon:* -${formatCurrency(lastOrderDetails.appliedDiscount)}`; }
                orderSummaryText += `\n*Total Tagihan:* ${formatCurrency(lastOrderDetails.grandTotal)}`;
                orderSummaryText += `\n*Metode Bayar:* ${isCodOrder ? 'COD (Bayar di Tempat)' : 'Transfer via DANA QRIS'}`;
                orderSummaryText += `\n\n*Dikirim ke:*\nNama: ${lastOrderDetails.customerName}\nAlamat: ${lastOrderDetails.customerAddress}\nTelepon: ${lastOrderDetails.customerPhone}\n\n`;
                if (isCodOrder) {
                    orderSummaryText += `Mohon siapkan pembayaran tunai sebesar ${formatCurrency(lastOrderDetails.grandTotal)} saat kurir tiba. Terima kasih.`;
                    alert(`Pesanan COD Berhasil Dibuat!\n\nNomor Resi Anda: ${lastOrderDetails.trackingNumber}\n\nAnda akan diarahkan ke WhatsApp untuk konfirmasi.`);
                } else {
                    orderSummaryText += `Saya sudah melakukan pembayaran. Mohon pesanan segera diproses. Terima kasih.`;
                    alert(`Pembayaran Berhasil!\n\nSimpan Nomor Resi Anda: ${lastOrderDetails.trackingNumber}\n\nAnda akan diarahkan ke WhatsApp untuk mengirim konfirmasi.`);
                }
                const whatsappUrl = `https://wa.me/6281211862924?text=${encodeURIComponent(orderSummaryText)}`;
                document.getElementById('checkout-form').reset(); cart = []; appliedDiscount = 0; updateCartCount();
                window.location.href = whatsappUrl;
                historyStack = ['catalog']; switchView('catalog');
            };
            const handleTrackingSubmit = (e) => { e.preventDefault(); const inputResi = document.getElementById('tracking-input').value.trim(); const resultContainer = document.getElementById('tracking-result-container'); if (!inputResi) { alert("Masukkan nomor resi."); return; } resultContainer.style.display = 'block'; if (lastOrderDetails && inputResi === lastOrderDetails.trackingNumber) { resultContainer.innerHTML = `<div class="tracking-result"><h3>Status Pengiriman: ${lastOrderDetails.trackingNumber}</h3><ul class="tracking-status"><li class="completed"><p class="status">Pesanan Diproses</p><p class="date">Jumat, 13 Jun 2025, 02:53</p></li><li class="completed"><p class="status">Paket Diserahkan ke Kurir (${lastOrderDetails.shippingName.split(' ')[0]})</p><p class="date">Jumat, 13 Jun 2025, 09:00</p></li><li><p class="status">Paket dalam Perjalanan ke Kota Tujuan</p><p class="date">Menunggu update...</p></li><li><p class="status">Paket Tiba di Kota Tujuan</p><p class="date">Menunggu update...</p></li></ul></div>`; } else { resultContainer.innerHTML = `<p class="empty-state">Nomor resi tidak ditemukan. Pastikan nomor resi sudah benar.</p>`; } };
            
            searchInput.addEventListener('input', (e) => { const query = e.target.value.toLowerCase(); const filtered = products.filter(p => p.name.toLowerCase().includes(query)); switchView('catalog'); renderCatalog(filtered); });
            backButton.addEventListener('click', () => { historyStack.pop(); const previousView = historyStack[historyStack.length - 1] || 'catalog'; switchView(previousView); });
            cartButton.addEventListener('click', () => { if (currentView !== 'cart') switchView('cart'); });
            trackOrderBtn.addEventListener('click', () => switchView('tracking'));
            brandLogo.addEventListener('click', () => { historyStack = ['catalog']; searchInput.value = ''; renderCatalog(); switchView('catalog'); });
            document.getElementById('start-shopping-button').addEventListener('click', () => switchView('catalog'));
            document.getElementById('checkout-button').addEventListener('click', () => switchView('checkout'));
            document.getElementById('cart-view').addEventListener('click', (e) => { const target = e.target.closest('.quantity-change, .remove-item'); if (!target) return; const cartItemElement = target.closest('.cart-item'); const productId = parseInt(cartItemElement.dataset.productId); if (target.classList.contains('quantity-change')) { const change = parseInt(target.dataset.change); updateCartQuantity(productId, change); } else if (target.closest('.remove-item')) { if (confirm('Anda yakin ingin menghapus item ini?')) { updateCartQuantity(productId, -Infinity); } } });
            shippingMethodSelect.addEventListener('change', () => { appliedDiscount = 0; couponInput.value = ''; updateCheckoutSummary(); });
            applyCouponBtn.addEventListener('click', handleApplyCoupon);
            document.getElementById('checkout-form').addEventListener('submit', handleCheckoutSubmit);
            document.getElementById('tracking-form').addEventListener('submit', handleTrackingSubmit);
            closeModalBtn.addEventListener('click', () => confirmOrderAndRedirect(false));
            modalOverlay.addEventListener('click', () => confirmOrderAndRedirect(false));
            
            try { if (typeof lucide !== 'undefined') { lucide.createIcons(); } renderCatalog(); } catch (error) { console.error("Gagal menginisialisasi aplikasi:", error); document.getElementById('app-main').innerHTML = '<p class="empty-state">Gagal memuat aplikasi. Silakan coba muat ulang halaman.</p>'; }
        });
    </script>
</body>
</html>
